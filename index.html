<!--
LBM (Leaflet Blog Manager)
Version: 0.6
License: MIT
applchu wuz here
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Metadata -->
    <title id="dynamic-title">LBM System</title>
    <meta id="dynamic-desc" name="description" content="A personal microblogging archive.">
    <!-- RSS -->
    <link id="dynamic-rss" rel="alternate" type="application/rss+xml" title="RSS Feed" href="rss.xml">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåø</text></svg>">
    
    <!-- CSP -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; img-src * data: blob:; media-src * data: blob:; connect-src * 'unsafe-inline';">
    
    <!-- Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="style.css">
    
    <style>
        #bridge-frame { width: 1px; height: 1px; opacity: 0; position: absolute; pointer-events: none; }
        
        /* Post Highlight Animation */
        .highlight-post { animation: highlightFade 2s ease-out; border: 1px solid var(--accent-color); }
        @keyframes highlightFade { 0% { box-shadow: 0 0 15px var(--accent-color); } 100% { box-shadow: none; } }

        /* Navigation Separators */
        .nav-separator {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
            padding-bottom: 10px;
        }
        .nav-label {
            font-family: var(--font-mono);
            font-size: 0.6rem;
            color: var(--accent-color);
            margin-bottom: 5px;
            display: block;
        }
    </style>
</head>

<body>

    <!-- Notifications -->
    <div id="toast-container"></div>

    <!-- Site Lock Overlay -->
    <div id="site-lock-overlay" style="display:none; position:fixed; inset:0; background:#050505; z-index:20000; align-items:center; justify-content:center; flex-direction:column;">
        <div class="upload-box" style="border-color:var(--dislike-color); box-shadow: 0 0 30px rgba(0,0,0,0.8);">
            <h3 style="color:var(--dislike-color); margin-bottom:10px; font-family: var(--font-display); letter-spacing: 2px;">ARCHIVE LOCKED</h3>
            <p style="color:#aaa; font-size:12px; font-family: var(--font-mono); margin-bottom:15px;">This system is password protected.</p>
            <form onsubmit="unlockSite(); return false;">
                <!-- Accessibility -->
                <input type="text" name="username" autocomplete="username" value="visitor" style="display:none;">
                <input type="password" id="site-lock-pass" class="setup-input" placeholder="Enter Password" autofocus style="text-align:center;" autocomplete="current-password">
                <button class="action-btn" type="submit" style="background:var(--dislike-color); color:black;">UNLOCK ACCESS</button>
            </form>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal">
        <div class="upload-box">
            <h3 style="color:var(--accent-color); margin-bottom:10px; font-family: var(--font-display); letter-spacing: 2px;">SYSTEM SYNC</h3>
            <p id="upload-status-text" style="color:#aaa; font-size:12px; font-family: var(--font-mono);">Initiating upload sequence...</p>
            <div class="progress-container">
                <div id="upload-progress-bar" class="progress-fill"></div>
            </div>
            <div id="upload-error-log" class="error-details"></div>
            <button id="upload-close-btn" class="action-btn" style="margin-top:15px; display:none;" onclick="hideUploadModal()">Close</button>
        </div>
    </div>

    <!-- Token Repair Modal -->
    <div id="repair-modal">
        <div class="upload-box">
            <h3 style="color:var(--dislike-color); margin-bottom:10px; font-family: var(--font-display);">CONNECTION REPAIR</h3>
            <p style="color:#aaa; font-size:12px; margin-bottom:15px; font-family: var(--font-mono);">Your Secure Token was rejected. Please re-authenticate.</p>
            <form onsubmit="runRepair(); return false;">
                <input type="text" name="username" autocomplete="username" style="display:none;">
                <input type="password" id="repair-api-key" class="setup-input" placeholder="Neocities API Key" style="margin-bottom:15px;" autocomplete="new-password">
                <button class="action-btn" type="submit">Generate New Token & Sync</button>
            </form>
            <button class="action-btn" onclick="document.getElementById('repair-modal').style.display='none'" style="background:transparent; border:none; margin-top:10px; color:#888;">Cancel</button>
        </div>
    </div>

    <!-- Setup Wizard -->
    <div id="setup-overlay" style="display:none;">
        <div class="setup-box">
            <h1 style="color:var(--accent-color); margin-bottom:20px; text-align:center;">SYSTEM BOOT // INITIAL SETUP</h1>
            <h3 style="margin-bottom:10px;">1. System Configuration</h3>
            <p style="font-size:11px; color:#aaa; margin-bottom:10px; font-family: var(--font-mono);">Create credentials. These will be encrypted into a Secure Token.</p>
            <form onsubmit="return false;">
                <input type="text" name="username" autocomplete="username" style="display:none;">
                <label style="font-size:11px; color:#aaa; margin-top:10px; font-family: var(--font-mono);">Create Admin Password:</label>
                <input type="password" id="setup-password" class="setup-input" placeholder="Password" autocomplete="new-password">
                <label style="font-size:11px; color:#aaa; margin-top:10px; display:block; font-family: var(--font-mono);">Neocities API Key:</label>
                <input type="password" id="setup-neocities-key" class="setup-input" placeholder="API Key (Will be encrypted)" autocomplete="off">
            </form>

            <h3 style="margin: 20px 0 10px 0;">2. Branding</h3>
            <div class="config-grid">
                <div class="config-item"><label>Site Name</label><input type="text" id="setup-site-name" class="setup-input" value="LBM // System" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Tagline</label><input type="text" id="setup-tagline" class="setup-input" value="Personal Archive" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Leaflets Tab</label><input type="text" id="setup-leaflets-name" class="setup-input" value="Leaflets" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Copyright</label><input type="text" id="setup-copyright" class="setup-input" value="2025 LBM" oninput="updateSetupPreview()"></div>
            </div>
            <div class="config-item" style="margin-bottom:10px;"><label>Profile Picture URL</label><input type="text" id="setup-pfp-image" class="setup-input" placeholder="https://..." oninput="updateSetupPreview()"></div>
            <div class="config-item" style="margin-bottom:10px;"><label>Header Banner URL</label><input type="text" id="setup-banner-image" class="setup-input" placeholder="https://..." oninput="updateSetupPreview()"></div>
            <div class="config-item" style="margin-bottom:10px;">
                <label>Site Password (Optional)</label>
                <input type="text" id="setup-site-password" class="setup-input" placeholder="Lock entire site..." oninput="updateSetupPreview()">
            </div>

            <h3 style="margin: 20px 0 10px 0;">3. Theme</h3>
            <div class="config-grid">
                <div class="config-item"><label>Background</label><input type="color" id="col-bg" class="color-picker" value="#010101" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Text</label><input type="color" id="col-text" class="color-picker" value="#e0f2f1" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Sidebar/Footer</label><input type="color" id="col-sidebar" class="color-picker" value="#0a0a0a" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Accent</label><input type="color" id="col-accent" class="color-picker" value="#ff6b35" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Post Bg</label><input type="color" id="col-leaflet" class="color-picker" value="#0a0a0a" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Borders</label><input type="color" id="col-border" class="color-picker" value="#1f2937" oninput="updateSetupPreview()"></div>
                <div class="config-item"><label>Active Nav</label><input type="color" id="col-nav-active" class="color-picker" value="#c8ff00" oninput="updateSetupPreview()"></div>
            </div>

            <h4 style="margin: 10px 0 5px 0; color: #aaa; border-bottom: 1px dotted #555; font-family: var(--font-mono);">Interaction Settings</h4>
            <div class="config-grid">
                <div class="config-item">
                    <label>Enable Reactions?</label>
                    <select id="setup-reactions-enabled" class="setup-input" onchange="updateSetupPreview()">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <div class="config-item">
                    <label>Icon Style</label>
                    <select id="setup-reaction-icon" class="setup-input" onchange="updateSetupPreview()">
                        <option value="face">Faces (^_^)</option>
                        <option value="thumb">Thumbs üëç</option>
                        <option value="arrow">Arrows ‚¨Ü</option>
                    </select>
                </div>
                <div class="config-item">
                    <label>Like Label</label>
                    <input type="text" id="setup-like-label" class="setup-input" value="(Ôºæ‚àáÔºæ)" oninput="updateSetupPreview()">
                </div>
                <div class="config-item">
                    <label>Dislike Label</label>
                    <input type="text" id="setup-dislike-label" class="setup-input" value="(Ôºõ„Å∏Ôºö)" oninput="updateSetupPreview()">
                </div>
            </div>
            <div class="config-grid">
                <div class="config-item">
                    <label>Like Color</label>
                    <input type="color" id="col-like" class="color-picker" value="#c8ff00" oninput="updateSetupPreview()">
                </div>
                <div class="config-item">
                    <label>Dislike Color</label>
                    <input type="color" id="col-dislike" class="color-picker" value="#ff3c8e" oninput="updateSetupPreview()">
                </div>
                <div class="config-item">
                    <label>Like Button Text</label>
                    <input type="color" id="col-like-btn" class="color-picker" value="#010101" oninput="updateSetupPreview()">
                </div>
                <div class="config-item">
                    <label>Dislike Button Text</label>
                    <input type="color" id="col-dislike-btn" class="color-picker" value="#010101" oninput="updateSetupPreview()">
                </div>
            </div>

            <div class="config-item" style="margin-bottom:10px;">
                <label>Widget Padding</label>
                <input type="text" id="setup-widget-padding" class="setup-input" value="1.5rem" oninput="updateSetupPreview()">
            </div>

            <div class="config-item" style="margin-bottom:10px;">
                <label>Global Background Image (Optional)</label>
                <input type="text" id="setup-bg-image" class="setup-input" placeholder="https://..." oninput="updateSetupPreview()">
            </div>

            <div class="config-item">
                <label>Allow Comments?</label>
                <select id="setup-comments" class="setup-input" onchange="updateSetupPreview()">
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>

            <div class="config-item" style="margin-bottom:15px;">
                <label>Custom CSS</label>
                <textarea id="setup-custom-css" class="setup-input" rows="4" placeholder="body { font-family: 'Arial'; }" oninput="updateSetupPreview()"></textarea>
            </div>

            <button class="action-btn" onclick="generateConfigFile('setup')" style="margin-top:20px;">ENCRYPT KEY & GENERATE system.js</button>
        </div>
    </div>

    <div id="edit-overlay" style="display:none;">
        <div class="setup-box">
            <h1 style="color:var(--accent-color); margin-bottom:20px; text-align:center;">EDIT LEAFLET</h1>
            
            <div class="md-toolbar">
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'b')" title="Bold">B</button>
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'i')" title="Italic">I</button>
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'q')" title="Quote">‚Äú ‚Äù</button>
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'h')" title="Heading">#</button>
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'l')" title="Link">üîó</button>
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'img')" title="Image">‚ßâ</button>
                <button class="md-btn" type="button" onclick="insertMarkdown('edit-post-content', 'c')" title="Code">&lt;&gt;</button>
            </div>
            <textarea id="edit-post-content" rows="6" placeholder="Content (HTML & Markdown supported)" class="setup-input has-toolbar"></textarea>
            
            <label style="font-size:11px; color:#aaa; margin-top:5px; font-family: var(--font-mono);">Media Path(s)</label>
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <input type="text" id="edit-add-media-input" placeholder="Add URL..." class="setup-input" style="margin-bottom:0;">
                <button class="action-btn" style="width:auto;" onclick="addUrlToQueue('edit')">Add</button>
            </div>
            <div id="edit-media-queue" class="media-queue"></div>
            <input type="hidden" id="edit-post-media">
            
            <label style="font-size:11px; color:#aaa; margin-top:5px; font-family: var(--font-mono);">Tags</label>
            <input type="text" id="edit-post-tags" placeholder="art, news" class="setup-input">

            <!-- Access Controls -->
            <label style="font-size:11px; color:#aaa; margin-top:10px; font-family: var(--font-mono);">Visibility & Access</label>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <select id="edit-post-visibility" class="setup-input" style="margin-bottom:0;" onchange="toggleEditPasswordInput()">
                    <option value="public">Public (Everyone)</option>
                    <option value="member">Members Only</option>
                    <option value="admin">Admin Only</option>
                    <option value="password">Password Protected</option>
                </select>
                <input type="text" id="edit-post-password" class="setup-input" placeholder="Set Access Password" style="margin-bottom:0; display:none;">
            </div>
            
            <div class="form-group" style="margin: 15px 0;">
                <input type="checkbox" id="edit-post-pin" style="vertical-align: middle;">
                <label for="edit-post-pin" style="color:#aaa; font-size:12px; font-family: var(--font-mono); vertical-align: middle; margin-left: 5px;">Pin to Top</label>
            </div>
            
            <input type="hidden" id="edit-post-id">
            
            <div style="display:flex; gap:10px;">
                <button class="action-btn" onclick="submitEditedPost()">Save Changes</button>
                <button class="action-btn" onclick="closeEditModal()" style="background:var(--dislike-color);">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="message-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(5px); z-index:10005; align-items:center; justify-content:center;">
        <div class="setup-box">
            <h3 style="margin-bottom:10px; color:var(--accent-color);">Send Message to Admin</h3>
            
            <!-- Tabs -->
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button class="action-btn small" id="msg-tab-write" onclick="toggleMsgMode('write')" style="background:var(--accent-color); color:#000;">Write</button>
                <button class="action-btn small" id="msg-tab-draw" onclick="toggleMsgMode('draw')" style="background:transparent; border:1px solid var(--border-color);">Draw</button>
            </div>

            <!-- Write Mode -->
            <div id="msg-mode-write">
                <div class="md-toolbar">
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'b')" title="Bold">B</button>
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'i')" title="Italic">I</button>
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'q')" title="Quote">‚Äú ‚Äù</button>
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'h')" title="Heading">#</button>
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'l')" title="Link">üîó</button>
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'img')" title="Image">‚ßâ</button>
                    <button class="md-btn" type="button" onclick="insertMarkdown('msg-content', 'c')" title="Code">&lt;&gt;</button>
                </div>
                <textarea id="msg-content" class="comment-form has-toolbar" rows="5" placeholder="Ask a question or send a request..."></textarea>
            </div>

            <!-- Draw Mode -->
            <div id="msg-mode-draw" style="display:none;">
                <div id="draw-container">
                    <canvas id="draw-canvas" width="500" height="500"></canvas>
                    <div class="draw-toolbar">
                        <div class="color-swatch active" style="background:#000000;" onclick="selectColor(this, '#000000')"></div>
                        <div class="color-swatch" style="background:#ff0000;" onclick="selectColor(this, '#ff0000')"></div>
                        <div class="color-swatch" style="background:#0000ff;" onclick="selectColor(this, '#0000ff')"></div>
                        <div class="color-swatch" style="background:#008000;" onclick="selectColor(this, '#008000')"></div>
                        <div style="width:1px; background:rgba(255,255,255,0.2); margin:0 5px;"></div>
                        <button class="tool-btn" onclick="selectTool('eraser')" title="Eraser">üßπ</button>
                        <button class="tool-btn" onclick="undoDraw()" title="Undo">‚Ü©</button>
                        <button class="tool-btn" onclick="redoDraw()" title="Redo">‚Ü™</button>
                        <button class="tool-btn" onclick="downloadDrawing()" title="Save to Device">üíæ</button>
                    </div>
                </div>
            </div>

            <div style="margin-top:10px; margin-bottom:15px;">
                <label style="font-size:0.8rem; color:#aaa; cursor:pointer;">
                    <input type="checkbox" id="msg-anon"> Send Anonymously
                </label>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="action-btn" onclick="submitMessage()">Send</button>
                <button class="action-btn" onclick="document.getElementById('message-overlay').style.display='none'" style="background:transparent; border:1px solid #555;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Layout -->
    <div class="container">
        <header id="site-header-block">
            <div class="header-overlay">
                <div class="header-row">
                    <div class="header-identity">
                        <!-- Navigation Toggle -->
                        <button id="hamburger-btn" onclick="toggleMobileMenu()">&#9776;</button>
                        
                        <img id="header-pfp" class="site-pfp" alt="PFP">
                        <div class="header-titles">
                            <h1 id="header-site-name">Loading...</h1>
                            <div id="header-tagline" class="site-tagline"></div>
                        </div>
                    </div>
                    <div id="db-status">Booting...</div>
                </div>
            </div>
        </header>

        <!-- Marquee -->
        <div class="marquee-container">
            <div class="marquee" id="marquee-content">
			<!-- Add your own scrolling text here -->
                <span>LEAFLET</span>
                <span>BLOG</span>
                <span>MANAGER</span>
                <span>LEAFLET</span>
                <span>BLOG</span>
                <span>MANAGER</span>
                <span>LEAFLET</span>
                <span>BLOG</span>
                <span>MANAGER</span>
                <span>LEAFLET</span>
                <span>BLOG</span>
                <span>MANAGER</span>
            </div>
        </div>

        <div class="layout-wrapper">
            <!-- Sidebar -->
            <nav class="sidebar" id="main-sidebar">
                <button id="mobile-close-btn" onclick="toggleMobileMenu()">&times; Close</button>
                
                <!-- Member Area (Top) -->
                <div class="nav-separator">
                    <span class="nav-label">MEMBER AREA</span>
                    
                    <!-- Guest View -->
                    <div id="guest-nav">
                        <button class="nav-btn" onclick="switchTab('member-login')" id="nav-login-btn" style="color:var(--accent-color);">Login</button>
                        <button class="nav-btn" onclick="switchTab('register')" id="nav-register-btn" style="font-size:0.75rem;">Register</button>
                    </div>

                    <!-- Member View -->
                    <div id="logged-in-nav" style="display:none;">
                        <div style="font-size:10px; color:var(--gray); margin-bottom:5px; padding-left:1rem;">HI, <span id="nav-username"></span></div>
                        <button class="nav-btn" onclick="switchTab('member-dashboard')">My Dashboard</button>
                    </div>
                    
                    <!-- Global Message Button -->
                    <button class="nav-btn" id="nav-send-msg-btn" onclick="openMessageModal()" style="display:none; color:var(--text-color); margin-top:5px;">&#9993; Send Message</button>
                </div>

                <button class="nav-btn active" onclick="switchTab('leaflets')" id="nav-leaflets-btn">Leaflets</button>
                <button class="nav-btn" onclick="switchTab('gallery')">Gallery</button>
                
                <!-- Tag Cloud -->
                <div id="tag-cloud-container"></div>
                
                <div style="height: 10px;"></div>
                
                <!-- Admin Area (Bottom) -->
                <div style="border-top:1px dotted var(--border-color); padding-top:10px; margin-top:auto;">
                    <button class="nav-btn" id="admin-login-tab-btn" onclick="switchTab('admin-login')" style="color: var(--gray); border-color: transparent;">Login</button>
                    <a href="rss.xml" class="nav-btn" target="_blank" style="color: var(--accent-color); border-color: transparent; text-decoration: none; display: block; margin-top: 5px;">
                        ‚¨á RSS Feed
                    </a>
                </div>
            </nav>
            
            <div id="sidebar-overlay" onclick="toggleMobileMenu()"></div>

            <main>
                <!-- Feed Tab -->
                <section id="tab-leaflets" class="view-section active">
                    <div class="feed-header">
                        <h2 id="header-leaflets-title">Recent Updates</h2>
                        <button id="clear-filter-btn" class="action-btn" style="display:none; width:auto; padding: 5px 10px; font-size: 0.7rem;" onclick="clearFilters()">Clear Filter</button>
                    </div>
                    <!-- Search Box -->
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="//search..." oninput="handleSearch(this.value)">
                        <select id="sort-filter" onchange="renderLeaflets()" class="sort-dropdown">
                            <option value="newest">Newest</option>
                            <option value="oldest">Oldest</option>
                            <option value="popular">Popular (Likes)</option>
                            <option value="controversial">Controversial (Dislikes)</option>
                        </select>
                    </div>
                    <div id="leaflets-container">Loading content...</div>
                </section>

                <!-- Gallery Tab -->
                <section id="tab-gallery" class="view-section">
                    <h2>Image Gallery</h2>
                    <div id="gallery-container" class="gallery-grid">Loading...</div>
                </section>

                <!-- Member Login Tab -->
                <section id="tab-member-login" class="view-section">
                    <h2>Member Login</h2>
                    <div class="admin-panel">
                        <p style="margin-bottom:15px; color:#aaa; font-family: var(--font-mono);">Access restricted content.</p>
                        <form onsubmit="memberLogin(); return false;">
                            <input type="text" id="member-user" class="setup-input" placeholder="Username" autocomplete="username">
                            <input type="password" id="member-pass" class="setup-input" placeholder="Password" autocomplete="current-password">
                            <button class="action-btn" type="submit">Login</button>
                        </form>
                    </div>
                </section>

                <!-- Register Tab -->
                <section id="tab-register" class="view-section">
                    <h2>Create Account</h2>
                    <div class="admin-panel">
                        <p style="margin-bottom:15px; color:#aaa; font-family: var(--font-mono);">Join the archive.</p>
                        <form onsubmit="registerMember(); return false;">
                            <input type="text" id="reg-user" class="setup-input" placeholder="Choose Username" autocomplete="new-username">
                            <input type="password" id="reg-pass" class="setup-input" placeholder="Choose Password" autocomplete="new-password">
                            <button class="action-btn" type="submit">Create Account</button>
                        </form>
                    </div>
                </section>

                <section id="tab-member-dashboard" class="view-section">
                    <h2>My Dashboard</h2>
                    <div class="admin-panel">
                        <h3 id="dash-welcome">Welcome</h3>
                        
                        <div style="margin:20px 0; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:20px;">
                            <h4 style="color:var(--accent-color); font-size:0.9rem; margin-bottom:10px;">My Recent Messages</h4>
                            <div id="member-messages-list" style="background:rgba(0,0,0,0.2); border-radius:8px; padding:10px; min-height:50px;">
                                <p style="font-size:0.8rem; color:var(--gray);">Loading...</p>
                            </div>
                            <button class="action-btn" onclick="openMessageModal()" style="width:auto; margin-top:10px; font-size:0.75rem;">+ New Message</button>
                        </div>

                        <div class="config-grid">
                            <div class="config-item">
                                <label>Change Password</label>
                                <form onsubmit="return false;" style="width: 100%;">
                                    <input type="text" name="username" autocomplete="username" style="display:none;">
                                    <input type="password" id="update-pass" class="setup-input" placeholder="New Password" autocomplete="new-password">
                                </form>
                            </div>
                        </div>
                        <button class="action-btn" onclick="updateMemberProfile()">Update Profile</button>
                        
                        <div style="margin-top:20px; border-top:1px dotted var(--border-color); padding-top:20px;">
                            <button class="action-btn" onclick="userLogout()" style="background:var(--dislike-color);">Logout</button>
                        </div>
                    </div>
                </section>

                <section id="tab-admin-login" class="view-section">
                    <h2>Admin // Access</h2>
                    <div class="admin-panel" style="border-color:var(--accent-color);">
                        <h3>System Override</h3>
                        <p style="margin-bottom:15px; color:#aaa; font-family: var(--font-mono);">Enter your admin password.</p>
                        <form onsubmit="adminLogin(); return false;">
                            <input type="text" name="username" autocomplete="username" style="display:none;">
                            <input type="password" id="login-pass" class="setup-input" placeholder="Password" style="margin-bottom:10px;" autocomplete="current-password">
                            <button class="action-btn" type="submit">Access Admin Panel</button>
                        </form>
                    </div>
                </section>

                <!-- Admin Tab -->
                <section id="tab-admin" class="view-section">
                    <h2>Admin // Dashboard</h2>

                    <div id="admin-dashboard" style="display:none;">
                        <div class="sync-status">
                            <div id="sync-dot" class="sync-indicator synced"></div>
                            <span id="sync-text">System Synced</span>
                            <div style="margin-left: auto; display:flex; gap:5px;">
                                <button onclick="forceSyncAll()" class="reaction-btn" style="color:var(--accent-color); border-color:var(--accent-color);">FORCE SYNC</button>
                                <button onclick="downloadBackup()" class="reaction-btn" title="Download Backup">‚¨á JS</button>
                                <button onclick="downloadStaticIndex()" class="reaction-btn" title="Download Static HTML for SEO" style="border-color:#aaa;">‚¨á HTML</button>
                                <button onclick="downloadRSS()" class="reaction-btn" title="Download RSS Feed" style="border-color:#ff9f43; color:#ff9f43;">‚¨á RSS</button>
                            </div>
                        </div>

                        <div style="display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap;">
                            <button class="action-btn" onclick="switchAdminSubTab('post')" style="flex:1;">New Post</button>
                            <button class="action-btn" onclick="switchAdminSubTab('users')" style="flex:1; background:var(--bg-dark); color: var(--text-color);">Users & Msgs</button>
                            <button class="action-btn" onclick="switchAdminSubTab('settings')" style="flex:1; background:var(--bg-dark); color: var(--text-color);">Settings</button>
                            <button class="action-btn" onclick="location.reload()" style="flex:0; background:var(--dislike-color);">Logout</button>
                        </div>

                        <!-- Post Editor -->
                        <div id="admin-sub-post" class="admin-panel">
                            <h3>Create New Content</h3>
                            <div class="form-group" style="margin-bottom: 15px;">
                                <div class="md-toolbar">
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'b')" title="Bold">B</button>
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'i')" title="Italic">I</button>
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'q')" title="Quote">‚Äú ‚Äù</button>
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'h')" title="Heading">#</button>
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'l')" title="Link">üîó</button>
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'img')" title="Image">‚ßâ</button>
                                    <button class="md-btn" type="button" onclick="insertMarkdown('admin-content', 'c')" title="Code">&lt;&gt;</button>
                                </div>
                                <textarea id="admin-content" rows="4" placeholder="What's on your mind? (Markdown & HTML supported)" class="setup-input has-toolbar"></textarea>
                            </div>
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label style="color:var(--accent-color); display:block; margin-bottom:5px; font-family: var(--font-mono); font-size: 0.7rem;">Media Upload (Will upload to img/)</label>
                                <div class="file-upload-wrapper" style="font-family: var(--font-mono); font-size: 0.8rem;">
                                    <input type="file" id="file-selector" onchange="handleFileSelect()" accept="image/*,video/*,audio/*" multiple>
                                    <div id="upload-file-info" style="display:none; margin-left:10px; font-size:11px; color:var(--accent-color);"></div>
                                    
                                    <div id="admin-media-queue" class="media-queue"></div>
                                </div>
                            </div>
                            
                            <!-- Add URL Input -->
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label style="color:var(--accent-color); display:block; margin-bottom:5px; font-family: var(--font-mono); font-size: 0.7rem;">Add External URL</label>
                                <div style="display:flex; gap:5px;">
                                    <input type="text" id="admin-media-input" placeholder="https://..." class="setup-input" style="margin-bottom:0;">
                                    <button class="action-btn" style="width:auto;" onclick="addUrlToQueue('admin')">Add</button>
                                </div>
                            </div>

                            <div class="form-group" style="margin-bottom: 15px;">
                                <input type="text" id="admin-tags" placeholder="Tags (comma separated: art, news, daily)" class="setup-input">
                            </div>

                            <!-- Access Controls -->
                            <div class="config-grid">
                                <div class="config-item">
                                    <label>Visibility</label>
                                    <select id="admin-post-visibility" class="setup-input" onchange="toggleAdminPasswordInput()">
                                        <option value="public">Public</option>
                                        <option value="member">Members Only</option>
                                        <option value="admin">Admin Only</option>
                                        <option value="password">Password Protected</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>Access Password</label>
                                    <input type="text" id="admin-post-password" class="setup-input" placeholder="Optional" disabled>
                                </div>
                            </div>

                            <!-- Pin Toggle -->
                            <div class="form-group" style="margin-bottom: 15px;">
                                <input type="checkbox" id="admin-pin" style="vertical-align: middle;">
                                <label for="admin-pin" style="color:#aaa; font-size:12px; font-family: var(--font-mono); vertical-align: middle; margin-left: 5px;">Pin to Top</label>
                            </div>
                            <button class="action-btn" onclick="addPost()">Post & Sync</button>
                        </div>

                        <!-- User Management & Messages -->
                        <div id="admin-sub-users" class="admin-panel" style="display:none;">
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                                <div>
                                    <h3>User Management</h3>
                                    <div style="margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:20px;">
                                        <h4>Create User</h4>
                                        <form onsubmit="createNewUser(); return false;">
                                            <div class="config-grid" style="grid-template-columns: 1fr;">
                                                <div class="config-item"><label>Username</label><input type="text" id="new-user-name" class="setup-input" autocomplete="new-username"></div>
                                                <div class="config-item"><label>Password</label><input type="password" id="new-user-pass" class="setup-input" autocomplete="new-password"></div>
                                                <div class="config-item">
                                                    <label>Type</label>
                                                    <select id="new-user-type" class="setup-input">
                                                        <option value="member">Member</option>
                                                        <option value="admin">Admin</option>
                                                        <option value="vip">VIP</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <button class="action-btn" type="submit">Create User</button>
                                        </form>
                                    </div>
                                    
                                    <h4>Existing Users</h4>
                                    <div id="users-list-container">Loading...</div>
                                </div>
                                
                                <div style="border-left:1px solid rgba(255,255,255,0.1); padding-left:20px;">
                                    <h3>Inbox / Asks</h3>
                                    <div id="admin-messages-list" style="max-height:500px; overflow-y:auto; padding-right:5px;">
                                        <p style="color:#aaa; font-size:0.8rem;">Loading messages...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Site Settings -->
                        <div id="admin-sub-settings" class="admin-panel" style="display:none;">
                            
                            <!-- Security -->
                            <form onsubmit="updateAdminCredentials(); return false;" style="margin-bottom:25px; border:1px solid var(--accent-color); padding:15px; border-radius:8px; background:rgba(255,107,53,0.05);">
                                <h4 style="color:var(--accent-color); border-bottom:none; margin-top:0;">Security // Admin Credentials</h4>
                                <p style="font-size:11px; color:#aaa; font-family:var(--font-mono); margin-bottom:10px;">Update your admin password. <span style="color:var(--dislike-color);">Requires Neocities API Key to regenerate Secure Token.</span></p>
                                <div class="config-grid">
                                    <div class="config-item"><label>New Password</label>
                                        <input type="text" name="username" autocomplete="username" style="display:none;">
                                        <input type="password" id="update-admin-pass" class="setup-input" autocomplete="new-password">
                                    </div>
                                    <div class="config-item"><label>Confirm</label><input type="password" id="update-admin-confirm" class="setup-input" autocomplete="new-password"></div>
                                </div>
                                <div class="config-item">
                                    <label>Neocities API Key (Required for Token Rotation)</label>
                                    <input type="password" id="update-admin-api-key" class="setup-input" placeholder="Enter API Key" autocomplete="off">
                                </div>
                                <button class="action-btn" type="submit" style="background:var(--bg-dark); border:1px solid var(--accent-color); color:var(--accent-color);">Update Admin Credentials</button>
                            </form>

                            <!-- Site Access -->
                            <h3 style="margin-top:15px;">Site Access</h3>
                            <div class="config-grid">
                                <div class="config-item">
                                    <label>Site Password (Leave blank to keep)</label>
                                    <form onsubmit="return false;" style="width:100%">
                                        <input type="text" name="username" autocomplete="username" style="display:none;">
                                        <input type="password" id="edit-site-password" class="setup-input" placeholder="New site password..." autocomplete="new-password">
                                    </form>
                                </div>
                                <div class="config-item" style="justify-content:flex-end;">
                                    <div style="display:flex; align-items:center; gap:5px; margin-bottom:10px;">
                                        <input type="checkbox" id="edit-disable-site-lock">
                                        <label for="edit-disable-site-lock" style="color:var(--dislike-color); margin:0;">Disable Site Lock</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Metadata Settings -->
                            <h3 style="margin-top:15px;">SEO & Metadata</h3>
                            <div class="config-grid">
                                <div class="config-item"><label>Window Title</label><input type="text" id="edit-window-title" class="setup-input" placeholder="My Blog" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Meta Description</label><input type="text" id="edit-meta-desc" class="setup-input" placeholder="A brief description..." oninput="updateLivePreview()"></div>
                            </div>

                            <h3 style="margin-top:15px;">Visual Customization</h3>
                            <div class="config-grid">
                                <div class="config-item"><label>Site Name</label><input type="text" id="edit-site-name" class="setup-input" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Tagline</label><input type="text" id="edit-tagline" class="setup-input" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Leaflets Name</label><input type="text" id="edit-leaflets-name" class="setup-input" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Copyright</label><input type="text" id="edit-copyright" class="setup-input" oninput="updateLivePreview()"></div>
                            </div>
                            <div class="config-grid">
                                <div class="config-item"><label>PFP URL</label><input type="text" id="edit-pfp-image" class="setup-input" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Banner URL</label><input type="text" id="edit-banner-image" class="setup-input" oninput="updateLivePreview()"></div>
                            </div>

                            <!-- Colors & Theme -->
                            <div class="config-grid">
                                <div class="config-item"><label>Bg</label><input type="color" id="edit-col-bg" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Text</label><input type="color" id="edit-col-text" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Sidebar</label><input type="color" id="edit-col-sidebar" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Accent</label><input type="color" id="edit-col-accent" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Post Bg</label><input type="color" id="edit-col-leaflet" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Borders</label><input type="color" id="edit-col-border" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Active Nav</label><input type="color" id="edit-col-nav-active" class="color-picker" oninput="updateLivePreview()"></div>
                            </div>
                            
                            <!-- Advanced UI Colors -->
                            <h5 style="margin: 10px 0 5px 0; color: #aaa; border-bottom: 1px dotted #555; font-family: var(--font-mono);">Advanced UI Colors</h5>
                            <div class="config-grid">
                                <div class="config-item"><label>Queue Bg</label><input type="color" id="edit-col-queue-bg" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Toast Bg</label><input type="color" id="edit-col-toast-bg" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Overlay Bg</label><input type="color" id="edit-col-overlay-bg" class="color-picker" oninput="updateLivePreview()"></div>
                            </div>
                            
                            <!-- Reset -->
                            <button class="action-btn" style="background:var(--border-color); color:var(--text-color); margin-top:10px; margin-bottom:20px;" onclick="resetColors()">Reset Colors to Default</button>

                            <!-- Interaction Settings -->
                            <div class="config-grid">
                                <div class="config-item">
                                    <label>Enable Reactions?</label>
                                    <select id="edit-reactions-enabled" class="setup-input" onchange="updateLivePreview()">
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>Allow Anon Msgs?</label>
                                    <div style="padding-top:10px;">
                                        <input type="checkbox" id="edit-allow-anon-msg" onchange="updateLivePreview()">
                                    </div>
                                </div>
                                <div class="config-item">
                                    <label>Disable Signups?</label>
                                    <div style="padding-top:10px;">
                                        <input type="checkbox" id="edit-disable-signups" onchange="updateLivePreview()">
                                    </div>
                                </div>
                                <div class="config-item">
                                    <label>Allow Video Downloads?</label>
                                    <div style="padding-top:10px;">
                                        <input type="checkbox" id="edit-allow-video-dl" onchange="updateLivePreview()">
                                    </div>
                                </div>
                                <div class="config-item">
                                    <label>Icon Style</label>
                                    <select id="edit-reaction-icon" class="setup-input" onchange="updateLivePreview()">
                                        <option value="face">Faces</option>
                                        <option value="thumb">Thumbs</option>
                                        <option value="arrow">Arrows</option>
                                    </select>
                                </div>
                                <div class="config-item"><label>Like Label</label><input type="text" id="edit-like-label" class="setup-input" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Dislike Label</label><input type="text" id="edit-dislike-label" class="setup-input" oninput="updateLivePreview()"></div>
                            </div>
                            <div class="config-grid">
                                <div class="config-item"><label>Like Color</label><input type="color" id="edit-col-like" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Dislike Color</label><input type="color" id="edit-col-dislike" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Like Text</label><input type="color" id="edit-col-like-btn" class="color-picker" oninput="updateLivePreview()"></div>
                                <div class="config-item"><label>Dislike Text</label><input type="color" id="edit-col-dislike-btn" class="color-picker" oninput="updateLivePreview()"></div>
                            </div>

                            <!-- Protection Settings -->
                            <div class="config-item" style="margin-bottom:15px; border-top:1px dotted #555; padding-top:15px;">
                                <label>Protected Tags (Comma separated)</label>
                                <input type="text" id="edit-protected-tags" class="setup-input" placeholder="private, members-only">
                                <p style="font-size:10px; color:#aaa; font-family: var(--font-mono);">Posts with these tags will automatically be set to 'Members Only' visibility.</p>
                            </div>
                            
                            <div class="config-item" style="margin-bottom:15px;"><label>Widget Padding</label><input type="text" id="edit-widget-padding" class="setup-input" oninput="updateLivePreview()"></div>
                            <div class="config-item" style="margin-bottom:15px;"><label>Global Background Image</label><input type="text" id="edit-bg-image" class="setup-input" oninput="updateLivePreview()"></div>
                            <div class="config-item" style="margin-bottom:15px;">
                                <label>Comments</label>
                                <select id="edit-comments" class="setup-input" onchange="updateLivePreview()">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>

                            <!-- Token Rotation -->
                            <div class="config-item" style="margin-bottom:15px; border-top:1px dotted #555; padding-top:15px;">
                                <label>Update API Key Only (Optional)</label>
                                <form onsubmit="return false;">
                                    <input type="text" name="username" autocomplete="username" style="display:none;">
                                    <input type="password" id="edit-neocities-key" class="setup-input" placeholder="Enter new key to rotate token" autocomplete="new-password">
                                </form>
                            </div>

                            <div class="config-item" style="margin-bottom:15px;">
                                <label>Custom CSS</label>
                                <textarea id="edit-custom-css" class="setup-input" rows="6" oninput="updateLivePreview()"></textarea>
                            </div>
                            
                            <!-- Token Status -->
                            <div style="font-size:10px; color:#555; text-align:center; margin-top:10px;">Auth Token Loaded</div>

                            <button class="action-btn" onclick="saveSystem()">Save Settings & Sync</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <footer>
        <div id="footer-text">
            &copy; 2025 LBM
        </div>
    </footer>

    <div id="leaflet-lightbox" class="lightbox" onclick="if(event.target === this) closeLightbox()">
        <div class="lightbox-content">
            <span class="close-btn" onclick="closeLightbox()">&times;</span>
            <div id="lightbox-body"></div>
        </div>
    </div>

    <div id="media-fullscreen-overlay" class="media-overlay" onclick="closeMediaViewer()">
        <span class="close-media-btn" onclick="closeMediaViewer()">&times;</span>
        <div id="media-content-wrapper" onclick="event.stopPropagation()"></div>
    </div>

    <div id="toast-container"></div>

    <script src="logic.js"></script>
</body>
</html>